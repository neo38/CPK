<script>
    // @TODO nechapu proc ale kdyz je to pouze v doc.ready tak to po prvnim vyhledavani prestane fungovat
    $( '.list-group' ).on('click', '.arrow', function( event ) {
        event.preventDefault();
        var classArrow = event.target.closest('li').id;
        console.log(classArrow);
        $('#ul-'+classArrow).toggleClass("hide");
    });
</script>

<?
$facetFilter = $data;
?>
<!-- hlavni nadpis facet hledani BEGIN -->
<h3 class='side-facets-header facets-questionmark-help'>
    <?= $this->transEsc(isset($this->overrideSideFacetCaption) ? $this->overrideSideFacetCaption : 'Narrow Search') ?>
</h3>
<!-- hlavni nadpis facet hledani END -->

<? // $filterList = array_merge($results->getParams()->getFilterList(true), $extraFilters); ?>
<!-- vypis filtr BEGIN -->
<?if (!empty($usedFilter)): ?>
    <? //var_dump($usedFilter); ?>
    <? $filterList = $usedFilter; ?>
  <div class="list-group filters">
      <? foreach ($filterList as $field => $filters): ?>

        <ul style="padding: 0; cursor: pointer;">
            <? foreach ($filters as $i => $filter): ?>
              <li class="active activedF" data-facet='<?=$filter['dataFacet']?>' style="padding-left: <?=($i > 0)? '20px' : '0px'?>;"><?=($i <= 0)?$this->transEsc($field) . ': ': ''?><b  style="color: grey; display: inline-block; width: <?=($i > 0)? '30px' : '0px'?>; font-weight: normal; font-size: 12px;"><?=($i > 0)? $filter['operator']: ''?></b>
                <span style="color: red;"><?= $filter['display']; ?></span></li>
            <? endforeach; ?>
        </ul>
      <? endforeach; ?>
    <div class='text-center'>
      <a id='remove-all-filters-async' href='<? //=$removeFilterUrl?>'><div class="btn btn-primary btn-sm"><?=$this->transEsc('Remove Filters')?></div></a>
    </div>
  </div>
<? endif; ?>
<!-- vypis filtr END -->
<? foreach ($facetFilter as $key => $filter) {?>
  <div id="side-panel-<?=$filter['encoded']?>" class="col-xs-12 list-group">
    <li class="arrow list-group-item title" id="facet-<?=$filter['encoded']?>">
      <span class="arrow-title">
          <?=$this->transEsc($filter['display'])?>
      </span>
    </li>
    <ul id="ul-facet-<?=$filter['encoded']?>" class="<?=(!$filter['show'])? 'hide': ''?>">
        <?
        if ($filter['label'] == 'adv_search_year') {
            //include_once 'SideFacets/PublishDate.phtml';
            echo '</ul></div>';
            continue;
        }
        $more = false;
        ?>
        <? foreach ($filter['list'] as $facet) { //echo $facet['value']?>
          <li class="list-group-item <?=(!$facet['show']? 'hide' : '')?>" id="facet-<?=$facet['name']?>">
              <?=($facet['children'])? '<b class="arrow"></b>' : ''?>
            <a href='<?=$facet['link']?>' class="facet-filter <?=($facet['operator'] == "OR")? 'list-group-item or-facet' : 'and-facet facetAND'?> <?=($facet['actived'] != 0)? ($facet['seq'] == $facet['actived'])? 'active full-active' : 'half-active' : ''?> <?=($facet['fullActive'])? 'active full-active' : ''?>" data-facet='<?=$facet['dataFacet']?>'>
              <script>
                  var el = document.getElementById('facet-<?=$facet['name']?>');
                  var moje = window.location.href;
                  moje = moje.substr(0, moje.indexOf('&filter'));
                  moje = moje + "&filter%5B%5D=";
                  var link = moje + specialUrlEncode(LZString.compressToBase64('<?=$facet['link']?>'));
                  el.getElementsByClassName('facet-filter')[0].href = link;
              </script>
            <span class="<?=($facet['operator'] == "OR")? 'item' : ''?>">
              <?=($facet['bold'])? '<b>' : '';?>
              <?=$facet['displayText']?>
              <?=($facet['bold'])? '</b>' : '';?>
            </span>
              <b class="badge"><?=(!is_null($facet['count'])) ? $facet['count'] : ''?></b>
            </a>

              <?if ($facet['children']) {?>
                <ul id="ul-facet-<?=$facet['name']?>" class="<?=(!$facet['open'] && !$facet['fullActive'] && !$facet['actived'])? 'hide': ''?>"></ul>
              <?}?>
              <? if ($facet['parent'] != $filter['encoded']) { ?>
                <script>
                    $('#ul-facet-<?=$facet['parent']?>').append($('#facet-<?=$facet['name']?>'));
                    $('#facet-<?=$facet['name']?>').append($('#ul-facet-<?=$facet['name']?>'));
                </script>
              <? }?>
          </li>
            <?
            $moreF = ($facet['value'] == $filter['more'] && !$more)? '<span id="more-facet-'.$facet['name'].'" class="show-all-facets narrow-toggle">'.$this->transEsc("More options").'</span>' : '';
            echo $moreF;
            if (!empty($moreF)) $more = true;
        } ?>
        <?=(!empty($more))? '<span id="less-'.$filter['encoded'].'" class="hide hide-some-facets narrow-toggle">'.$this->transEsc("less").'</span>' : ''?>
    </ul>

  </div>
<? } ?>
