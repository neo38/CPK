<?
    $accessLevel = $this->driver->getAccessLevel();
    $restrictedView = empty($accessLevel) ? false : true;
    $recordId = $this->driver->getUniqueID();
    $recordSource = explode('.', $recordId)[0];
    $format = $this->driver->getPubTypeId();
    $items = $this->driver->getItems();
    $lookfor = $this->results->getUrlQuery()->isQuerySuppressed()
        ? $this->record($this->driver)->getObalkyKnihAdvert('results')
        : $this->params->getDisplayQuery();

    $recordIdHash = md5($recordId);
    $this->headScript()->appendFile('jquery-ui.min.js');
    $issns = $this->driver->getIssns();
    $isbns = $this->driver->getIsbns();
    $publishDate = $this->driver->getPublishDate();
    $titles = $this->driver->getTitles();
    $authors = $this->driver->getAuthors();
    $sourceTitle = $this->driver->getSourceTitle();
    $volume = $this->driver->getVolume();
    $accessUrl = $this->driver->getAccessUrl();
?>
<div class='white-box clearfix eds-record-container'>
  <div class='row col-xs-12 source<?=$this->escapeHtmlAttr($this->driver->getSourceIdentifier())?>
              recordId<?=$this->driver->supportsAjaxStatus() ? ' ajaxItemId' : ''?>'>
    <input type='hidden' value='<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>' class='hiddenId' />
    <div class='col-sm-2 col-xs-3 left'>
      <div class='coverThumbnail cover_<?=$id?>'>
        <div class='iconlabel'><i class='record-icon-label pr-format-eds-<?=$format ?: 'unknown'?>'></i></div>
      </div>
    </div>
    <div class='col-sm-7 col-xs-7 middle search-result-container'>
      <? $items = $this->driver->getItems(); ?>
      <? if (isset($items) && !empty($items)): ?>
        <? foreach ($items as $item): ?>
          <? if (!empty($item)): ?>
            <div class='resultItemLine1'>
              <? if ('Ti' == $item['Group']): ?>
                <div class='root-title'>
                  <a href='<?=$this->recordLink()->getUrl($this->driver)?>?referer=<?=$this->referer?>'
                     class='title _record_link'>
                    <?=$item['Data']?>
                  </a>
                </div>
              <? elseif ('Au' == $item['Group']): $author = $item['Data'];?>
                <span title='<?=$this->translate('Show publications by')?> <?=strip_tags($author)?>'
                      class='eds-author-info'>
                  <?=$author?>
                </span>
              <? else: ?>
                <p>
                  <b><?=$this->transEsc($item['Label'])?>:</b>
                  <?=$item['Data']?>
                </p>
              <? endif; ?>
            </div>
          <? endif; ?>
        <? endforeach; ?>
      <? elseif ($restrictedView): ?>
        <div class='resultItemLine1'>
          <p>
            <?=$this->transEsc('This result is not displayed to guests')?>
            <br>
            <a class='login' href='<?=$this->url('myresearch-home')?>'>
              <strong><?=$this->transEsc('Login for full access')?></strong>
            </a>
          </p>
        </div>
      <? endif; ?>

      <div class='row'>
        <div class='col-md-8'>
          <div class='format-list pull-left inline-block'>
            <? if (! empty($format)): ?>
              <div class='iconlabel record-icon-format'>
                <i class='small-format-icon pr-format-eds-<?=$format?>'></i>
                <span class='format-text'>
                  <?= $this->translate($format) ?>
                </span>
              </div>
            <? endif; ?>
          </div>
        </div>
        <div class='col-md-4 search-results-favorite-button hidden pull-right'>
          <? if ($this->userlist()->getMode() !== 'disabled'):
            $controllerClass = 'controller:' . $this->record($this->driver)->getController();
            $handleOfflineFavorites = ! $this->isLoggedIn && $this->offlineFavoritesEnabled; ?>
            <li class='list-group-item'>
              <a id='save-record'
                 class='modal-link <?=$controllerClass?>'
                 title='<?=$this->transEsc('Add to favorites')?>'
                 rel='nofollow'
                <? if ($handleOfflineFavorites) : ?>
                    href='#' data-ng-click='searchFavCtrl.addOrRemoveFavorite(<?=$_ENV['currentRecordNo'] ?: "" ?>)'
                <? else: ?>
                    href='<?=$this->recordLink()->getActionUrl($this->driver, 'Save')?>'
                <? endif; ?>
                 >
                <i class='pr-interface-favoritestar'> </i>
                  <span data-add-remove-search='add<?=$_ENV['currentRecordNo'] ? ':' . $_ENV['currentRecordNo'] : "" ?>'>
                    <?=$this->transEsc('Add to favorites')?>
                  </span>
                  <span data-add-remove-search='rem<?=$_ENV['currentRecordNo'] ? ':' . $_ENV['currentRecordNo'] : "" ?>'
                        hidden
                        class='bold'>
                    <?=$this->transEsc('remove_from_favorites')?>
                  </span>
              </a>
            </li>
          <? endif; ?>
        </div>
      </div>

    </div>

    <div class='col-sm-3 col-xs-12 right d-table'>
      <div id='eds-links'>

        <div id='only-one-eds-link-header-<?=$recordIdHash?>' class='records-in-libraries-title d-none f-s-110'>
          <div class='eds-results-questionmarkhelp'>
            <?= $this->help()->getQuestionMarkHelp('eds-links-found') ?>
          </div>
          <?= $this->translate('Fulltext is avalable for users of this institution') ?>:
        </div>
        <div id='many-eds-links-header-<?=$recordIdHash?>' class='records-in-libraries-title d-none f-s-110'>
          <div class='eds-results-questionmarkhelp'>
            <?= $this->help()->getQuestionMarkHelp('eds-links-found') ?>
          </div>
          <?= $this->translate('Fulltext is avalable for users of these institutions') ?>:
        </div>
        <div id='free-eds-link-available-<?=$recordIdHash?>' class='records-in-libraries-title d-none f-s-110'>
          <div class='eds-results-questionmarkhelp'>
            <?= $this->help()->getQuestionMarkHelp('eds-links-found') ?>
          </div>
          <?= $this->translate('Fulltext is free') ?>
        </div>

        <table class='table table-striped'>
          <tbody>
            <div id='eds-links-placeholder-<?=$recordIdHash?>'>
              <div class='eds-results-questionmarkhelp' id='no-eds-links-<?=$recordIdHash?>'>
                <?= $this->help()->getQuestionMarkHelp('eds-links-not-found') ?>
              </div>
              <!-- Ajax Placeholder -->
            </div>
          </tbody>
        </table>

      </div>
    </div>
    
    <?=$this->record($this->driver)->getFormatList()?>

  </div>
</div>

<script>
    jQuery( document ).ready( function( $ ) {

        let $_data = {
            accessUrl: <?= $accessUrl ? "'$accessUrl'" : "false"; ?>,
            containsFulltext: <?= $containsFulltext ? "'$containsFulltext'" : "false"; ?>,
            recordIdHash: '<?= $recordIdHash ?>',
            recordId: <?= $recordId ? "'$recordId'" : "null" ?>,
        };
        handleEdsSearchResults($_data);
    });
</script>